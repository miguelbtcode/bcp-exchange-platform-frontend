<p-dialog
  [(visible)]="visible"
  [header]="isEditMode ? 'Editar Tipo de Cambio' : 'Nuevo Tipo de Cambio'"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [styleClass]="'exchange-rate-modal'"
  [contentStyle]="{ 'padding': '0' }"
  (onHide)="onClose()">

  <div class="p-6">
    <form (ngSubmit)="onSubmit()">
      <div class="space-y-4">
        <div>
          <label for="sourceCurrency" class="block text-sm font-medium text-gray-700 mb-2">
            Moneda Origen <span class="text-red-500">*</span>
          </label>
          <p-dropdown
            id="sourceCurrency"
            [(ngModel)]="formData.currencySourceId"
            [options]="currencies"
            optionLabel="description"
            optionValue="id"
            name="sourceCurrency"
            placeholder="Seleccione la moneda origen"
            [filter]="true"
            filterBy="code,description"
            [disabled]="isEditMode"
            styleClass="w-full"
            [style]="{'width': '100%'}"
          >
            <ng-template pTemplate="item" let-currency>
              <div class="flex flex-col">
                <span class="font-semibold">{{ currency.code }}</span>
                <span class="text-sm text-gray-600">{{ currency.description }}</span>
              </div>
            </ng-template>
            <ng-template pTemplate="selectedItem" let-currency>
              <div *ngIf="currency">
                <span class="font-semibold">{{ currency.code }}</span> - {{ currency.description }}
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div>
          <label for="targetCurrency" class="block text-sm font-medium text-gray-700 mb-2">
            Moneda Destino <span class="text-red-500">*</span>
          </label>
          <p-dropdown
            id="targetCurrency"
            [(ngModel)]="formData.currencyTargetId"
            [options]="currencies"
            optionLabel="description"
            optionValue="id"
            name="targetCurrency"
            placeholder="Seleccione la moneda destino"
            [filter]="true"
            filterBy="code,description"
            [disabled]="isEditMode"
            styleClass="w-full"
            [style]="{'width': '100%'}"
          >
            <ng-template pTemplate="item" let-currency>
              <div class="flex flex-col">
                <span class="font-semibold">{{ currency.code }}</span>
                <span class="text-sm text-gray-600">{{ currency.description }}</span>
              </div>
            </ng-template>
            <ng-template pTemplate="selectedItem" let-currency>
              <div *ngIf="currency">
                <span class="font-semibold">{{ currency.code }}</span> - {{ currency.description }}
              </div>
            </ng-template>
          </p-dropdown>
        </div>

        <div>
          <label for="rate" class="block text-sm font-medium text-gray-700 mb-2">
            Tipo de Cambio <span class="text-red-500">*</span>
          </label>
          <input
            id="rate"
            type="number"
            [(ngModel)]="formData.rate"
            name="rate"
            step="0.0001"
            min="0"
            placeholder="Ej: 3.75"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent text-gray-900 placeholder-gray-400"
            required
          />
          <small class="text-gray-500 mt-1 block">Ingrese el valor del tipo de cambio</small>
        </div>
      </div>

      <div class="flex items-center justify-end gap-3 mt-6">
        <button
          type="button"
          (click)="onClose()"
          class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-md transition-colors duration-200"
        >
          Cancelar
        </button>
        <button
          type="submit"
          [disabled]="!isFormValid()"
          [class.opacity-50]="!isFormValid()"
          [class.cursor-not-allowed]="!isFormValid()"
          class="px-4 py-2 bg-gray-900 hover:bg-gray-800 text-white font-semibold rounded-md transition-colors duration-200 disabled:hover:bg-gray-900"
        >
          {{ isEditMode ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>
    </form>
  </div>
</p-dialog>
